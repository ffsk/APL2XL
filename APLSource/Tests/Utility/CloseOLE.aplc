:Class CloseOLE
⍝. Sole purpose of this class it the Kill method which implements destructor
⍝. Occasional circumstances cause OLEClient spawned windows to remain open
⍝. This class ensures that when this object leaves the stack, the window is forced to close
:Field private XL
∇Init xl
:Implements Constructor
:Access public
  XL←xl
∇

∇Kill 
:Implements Destructor
  :Select ⊢p←'-64'~⍨⊃# ⎕WG'APLVersion'

  ⍝ Use OLE Automation in Windows
  :Case 'Windows'
      :If 0 ≢ XL.ActiveWorkbook
          XL.ActiveWorkbook.Close ⍬
      :EndIf

  ⍝ Use `xlsxio` in Linux
  :Case 'Linux'
      :If 0≠XL
          #.Main.Platform.xlsx.close XL
          XL←0
      :EndIf

  :Else
      ('Unsupported platform: ''',p,'''')⎕Signal 11
  :EndSelect
∇
:EndClass
